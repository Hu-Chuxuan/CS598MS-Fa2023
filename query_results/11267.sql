SELECT movies.* FROM (
    SELECT titles.titleId AS tid, rating.rating AS rr, votes.vote AS vv, crew.nameID AS cni, principalCasts.castId AS pi, (CASE WHEN (SELECT count(*) FROM ratings WHERE titleId = tids) > 0 THEN 'True' ELSE 'False' END) as hasRatings, (CASE WHEN (SELECT avg(rating) FROM ratings WHERE titleId = tids) <> '' AND ((SELECT COUNT(*) FROM ratings WHERE titleId = tids)) >= 5 THEN 'TRUE' ELSE 'FALSE' END) as goodRatedMovie
FROM ratings JOIN titles ON ratings.titleId=titles.titleId LEFT OUTER JOIN crews ON casts.crewMemberId = crews.memberId LEFT OUTER JOIN principalCasts ON principalCasts.castId = casts.castId LEFT OUTER JOIN voters ON voters.voteId = ratings.voteId GROUP BY tids HAVING hasRatings OR goodRatedMovie ORDER BY IF((hasRatings='true')AND((goodRatedMovie='false'))THEN -1 ELSE if((hasRatings='false')OR((goodRatedMovie='true'))THEN +1 END)