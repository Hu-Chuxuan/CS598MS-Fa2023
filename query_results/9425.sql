SELECT * FROM (SELECT t.*, r.averageRating AS avgRate, COUNT(*) OVER() AS totalViews FROM (( SELECT t.tconst, tb.avgRate, tb.numVotes, tb.primaryTitle, tb.startYear, tb.runtimeMinutes, tb.genre FROM title_basic AS t INNER JOIN ( SELECT tc.tconst, AVG(rating) AS avgRate,COUNT(*)/SUM(voteCount) AS numVotes FROM rate WHERE title_type = 'Movie' AND title_id IN ( SELECT DISTINCT titleID FROM ( SELECT distinct tc.tconst FROM title_base AS t LEFT OUTER JOIN rating AS r ON t.tconst=r.title_id ) AS s GROUP BY t.tconst ORDER BY SUM(voteCount)) ) AS tb ON tb.tconst = t.tconst ) UNION ALL SELECT d.tconst, d.directors, d.writers FROM title_crew AS d ) AS t INNER JOIN ( SELECT tc.tconst,AVG(rating)AS avgRate, COUNT (*)/SUM(voteCount) AS numVotes FROM rate WHERE title_type='Movie'AND title_id IN (SELECT DISTINCT titleID from (SELECT distinct tc.tconst from title_base AS t left outer join rating as r on t.tconst = r.title_id where r.user_id like '%1%' order by sum(votecount))) as s group by tc.tconst order by sum(votecount)) as tb ON t.tconst =tb.tconst) AS t WHERE t.isAdult!= '1' AND t.originalTitle LIKE CONCAT('%',?,'%') OR t.primaryTitle LIKE CONCAT('%','?','%')