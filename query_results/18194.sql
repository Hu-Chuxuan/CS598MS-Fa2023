SELECT * FROM ( SELECT DISTINCT TITLEID, RATINGS FROM MOVIES WHERE STARTAGE =? AND ISADULT=TRUE ) AS CURRENTMOVIES JOIN ( SELECT DISTINCT TITLEID, AVG(AVGRATED), NUMBEROFUSERSFROMTHEHISTORYTABLEWITHSAMETITLEASCURRENTTITLES FROM USERPREFERENCES WHERE HISTORYDATE > DATEADD(DAY,-365,'2019-01-01') GROUP BY TITLEID ORDER BY NUMBEROFUSERSFROMTHEHISTORYTABLEWITHSAMEMOTEASCURRENTTITLES DESC LIMIT 10) AS RECOMMENDATIONS ON CURRENTMOVIES.TITLEID = RECOMMENDATIONS.TITLEID 